<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DirectoryServerRule.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">LDAPUnit</a> &gt; <a href="index.source.html" class="el_package">com.buralotech.oss.ldapunit</a> &gt; <span class="el_source">DirectoryServerRule.java</span></div><h1>DirectoryServerRule.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2013-2024 Brian Thomas Matthews
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package com.buralotech.oss.ldapunit;

import org.junit.rules.TestRule;
import org.junit.runner.Description;
import org.junit.runners.model.Statement;

/**
 * A JUnit test rule that starts an embedded LDAP directory server. The configuration for the directory server
 * is obtained from the {@link DirectoryServerConfiguration} annotation applied to either the test method or the test
 * class.
 *
 * @author &lt;a href=&quot;mailto:bmatthews68@gmail.com&quot;&gt;Brian Matthews&lt;/a&gt;
 * @since 1.0.0
 */
<span class="fc" id="L31">public final class DirectoryServerRule implements TestRule {</span>

    /**
     * The current configuration for the in-memory LDAP directory server.
     * @since 1.0.2
     */
    private DirectoryServerConfiguration annotation;

    /**
     * Modifies the method-running {@link Statement} to implement this test-running rule. The configuration for
     * the embedded LDAP directory server is obtained from the {@link DirectoryServerConfiguration} annotation that was
     * applied to either the test class or test method.
     *
     * @param base        The {@link Statement} to be modified
     * @param description A {@link Description} of the test implemented in {@code base}
     * @return If no configuration was found then {@code base} is returned. Otherwise, a new
     *         {@link DirectoryServerStatement} that wraps {@code base} is returned.
     */
    public Statement apply(final Statement base, final Description description) {
<span class="fc" id="L50">        annotation = description.getAnnotation(DirectoryServerConfiguration.class);</span>
<span class="fc bfc" id="L51" title="All 2 branches covered.">        if (annotation == null) {</span>
<span class="fc" id="L52">            final Class&lt;?&gt; testClass = description.getTestClass();</span>
<span class="fc" id="L53">            annotation = testClass.getAnnotation(DirectoryServerConfiguration.class);</span>
        }
<span class="fc bfc" id="L55" title="All 2 branches covered.">        if (annotation != null) {</span>
<span class="fc" id="L56">            return new DirectoryServerStatement(base, annotation);</span>
        }
<span class="fc" id="L58">        return base;</span>
    }

    /**
     * Verify that an entry identified by {@code dn} exists.
     *
     * @param dn The distinguished name.
     * @return {@code true} if an entry identified by {@code dn} exists. Otherwise, {@code false} is returned.
     * @since 1.0.2
     */
    public boolean verifyDNExists(final String dn) {
<span class="fc" id="L69">        try (DirectoryTester directoryTester = getDirectoryTester()) {</span>
<span class="fc" id="L70">            return directoryTester.verifyDNExists(dn);</span>
        }
    }

    /**
     * Verify that the entry identified by {@code dn} is of type {@code objectclass}.
     *
     * @param dn          The distinguished name.
     * @param objectclass The type name.
     * @return {@code true} if an entry identified by {@code dn} exists and has attribute named {@code objectclass}.
     *         Otherwise, {@code false} is returned.
     * @since 1.0.2
     */
    public boolean verifyDNIsA(final String dn,
                               final String objectclass) {
<span class="fc" id="L85">        try (DirectoryTester directoryTester = getDirectoryTester()) {</span>
<span class="fc" id="L86">            return directoryTester.verifyDNIsA(dn, objectclass);</span>
        }
    }

    /**
     * Verify that the entry identified by {@code dn} has an attribute named {@code attributeName}.
     *
     * @param dn            The distinguished name.
     * @param attributeName The attribute name.
     * @return {@code true} if an entry identified by {@code dn} exists and has an attributed named
     *         {@code attributeName}. Otherwise, {@code false} is returned.
     * @since 1.0.2
     */
    public boolean verifyDNHasAttribute(final String dn,
                                        final String attributeName) {
<span class="fc" id="L101">        try (DirectoryTester directoryTester = getDirectoryTester()) {</span>
<span class="fc" id="L102">            return directoryTester.verifyDNHasAttribute(dn, attributeName);</span>
        }
    }

    /**
     * Verify that the entry identified by {@code dn} has an attribute named {@code attributeName} with
     * the attribute value(s) {@code attributeName}.
     *
     * @param dn             The distinguished name.
     * @param attributeName  The attribute name.
     * @param attributeValue The attribute value(s).
     * @return {@code true} if an antry identified by {@code dn} exists with an an attribute named {@code attributeName}
     *         that has value(s) {@code attributeValue}. Otherwise, {@code false} is returned.
     * @since 1.0.2
     */
    public boolean verifyDNHasAttributeValue(final String dn,
                                             final String attributeName,
                                             final String... attributeValue) {
<span class="fc" id="L120">        try (DirectoryTester directoryTester = getDirectoryTester()) {</span>
<span class="fc" id="L121">            return directoryTester.verifyDNHasAttributeValue(dn, attributeName, attributeValue);</span>
        }
    }

    /**
     * Assert that an entry identified by {@code dn} exists.
     *
     * @param dn The distinguished name.
     * @since 1.0.2
     */
    public void assertDNExists(final String dn) {
<span class="fc" id="L132">        try (DirectoryTester directoryTester = getDirectoryTester()) {</span>
<span class="fc" id="L133">            directoryTester.assertDNExists(dn);</span>
        }
<span class="fc" id="L135">    }</span>

    /**
     * Assert that the entry identified by {@code dn} is of type {@code objectclass}.
     *
     * @param dn          The distinguished name.
     * @param objectclass The type name.
     * @since 1.0.2
     */
    public void assertDNIsA(final String dn,
                            final String objectclass) {
<span class="fc" id="L146">        try (DirectoryTester directoryTester = getDirectoryTester()) {</span>
<span class="fc" id="L147">            directoryTester.assertDNIsA(dn, objectclass);</span>
        }
<span class="fc" id="L149">    }</span>

    /**
     * Assert that the entry identified by {@code dn} has an attribute named {@code attributeName}.
     *
     * @param dn            The distinguished name
     * @param attributeName The attribute name
     * @since 1.0.2
     */
    public void assertDNHasAttribute(final String dn,
                                     final String attributeName) {
<span class="fc" id="L160">        try (DirectoryTester directoryTester = getDirectoryTester()) {</span>
<span class="fc" id="L161">            directoryTester.assertDNHasAttribute(dn, attributeName);</span>
        }
<span class="fc" id="L163">    }</span>

    /**
     * Assert that the entry identified by {@code dn} has an attribute named {@code attributeName} with
     * the attribute value(s) {@code attributeName}.
     *
     * @param dn             The distinguished name
     * @param attributeName  The attribute name
     * @param attributeValue The attribute value(s)
     * @since 1.0.2
     */
    public void assertDNHasAttributeValue(final String dn,
                                          final String attributeName,
                                          final String... attributeValue) {
<span class="fc" id="L177">        try (DirectoryTester directoryTester = getDirectoryTester()) {</span>
<span class="fc" id="L178">            directoryTester.assertDNHasAttributeValue(dn, attributeName, attributeValue);</span>
        }
<span class="fc" id="L180">    }</span>

    /**
     * Create a {@link DirectoryTester} that connects to the in-memory LDAP directory server created by this rule.
     *
     * @return The {@link DirectoryTester}.
     * @since 1.0.2
     */
    private DirectoryTester getDirectoryTester() {
<span class="fc" id="L189">        return new DirectoryTester(&quot;localhost&quot;, annotation.port(), annotation.authDN(),</span>
<span class="fc" id="L190">                annotation.authPassword());</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>